---
alwaysApply: true
---


# IdentaPlus School - Flutter Project Rules

## ğŸ—ï¸ Arquitectura del Proyecto

### TecnologÃ­as Principales
- **Flutter**: Framework principal para desarrollo multiplataforma
- **Dart**: Lenguaje de programaciÃ³n
- **Provider**: GestiÃ³n de estado (MVVM pattern)
- **Riverpod**: GestiÃ³n de estado avanzada (en algunas features)
- **Freezed**: GeneraciÃ³n de cÃ³digo para modelos inmutables
- **Clean Architecture**: SeparaciÃ³n de capas (Data, Domain, Presentation)
- **Screaming Architecture**: Estructura organizada por features

### Patrones de DiseÃ±o
- **MVVM (Model-View-ViewModel)**: Con Provider como ViewModel
- **Repository Pattern**: Para acceso a datos
- **Use Case Pattern**: Para lÃ³gica de negocio
- **Dependency Injection**: Con GetIt
- **Observer Pattern**: Con Provider/Riverpod

## ğŸ“ Estructura del Proyecto

### Core (`lib/core/`)
```
lib/core/
â”œâ”€â”€ navigation/
â”‚   â”œâ”€â”€ constants/
â”‚   â”‚   â””â”€â”€ route_paths.dart          # Rutas de navegaciÃ³n
â”‚   â””â”€â”€ router.dart                   # ConfiguraciÃ³n de navegaciÃ³n
â”œâ”€â”€ util/                             # Funciones reutilizables
â”œâ”€â”€ values/
â”‚   â”œâ”€â”€ values_api.dart               # Constantes de APIs
â”‚   â”œâ”€â”€ values_app.dart               # Constantes generales
â”‚   â”œâ”€â”€ values_collection.dart        # Constantes Firebase
â”‚   â”œâ”€â”€ values_inputs.dart            # Constantes de inputs
â”‚   â””â”€â”€ values_shared_preferences.dart # Constantes de almacenamiento
â”œâ”€â”€ network/
â”‚   â””â”€â”€ apiconnect.dart               # Cliente HTTP
â”œâ”€â”€ modeling/
â”‚   â”œâ”€â”€ provider/
â”‚   â”‚   â””â”€â”€ base_provider.dart        # Provider base
â”‚   â”œâ”€â”€ dto/                          # Data Transfer Objects
â”‚   â”œâ”€â”€ enum/                         # Enumeraciones
â”‚   â””â”€â”€ extension/                    # Extensiones
â”œâ”€â”€ di/
â”‚   â””â”€â”€ core_di.dart                  # InyecciÃ³n de dependencias
â”œâ”€â”€ db/                               # Base de datos local
â”œâ”€â”€ singleton/                        # Singletons de la app
â””â”€â”€ feature/                          # Features core (login, user info)
```

### Features (`lib/features/`)
```
lib/features/
â”œâ”€â”€ feature_name/
â”‚   â”œâ”€â”€ feature_name_export.dart      # Archivo de exportaciÃ³n central
â”‚   â”œâ”€â”€ di/
â”‚   â”‚   â””â”€â”€ feature_name_di.dart      # DI especÃ­fico del feature (Riverpod)
â”‚   â”œâ”€â”€ data/
â”‚   â”‚   â””â”€â”€ repositories/
â”‚   â”‚       â””â”€â”€ feature_name_repository.dart
â”‚   â”œâ”€â”€ domain/
â”‚   â”‚   â”œâ”€â”€ entities/
â”‚   â”‚   â”‚   â””â”€â”€ feature_entity.dart
â”‚   â”‚   â””â”€â”€ use_cases/
â”‚   â”‚       â””â”€â”€ feature_use_case.dart
â”‚   â””â”€â”€ presentation/
â”‚       â”œâ”€â”€ provider/
â”‚       â”‚   â”œâ”€â”€ feature_name_provider.dart
â”‚       â”‚   â”œâ”€â”€ feature_name_state.dart
â”‚       â”‚   â””â”€â”€ feature_name_state.freezed.dart
â”‚       â”œâ”€â”€ controller/
â”‚       â”‚   â””â”€â”€ feature_name_controller.dart
â”‚       â””â”€â”€ screens/
â”‚           â”œâ”€â”€ feature_name_screen.dart
â”‚           â”œâ”€â”€ feature_name_loading_screen.dart
â”‚           â””â”€â”€ feature_name_error_screen.dart
```

### InternacionalizaciÃ³n (`lib/l10n/`)
- Archivos de traducciÃ³n en formato ARB
- Soporte para espaÃ±ol e inglÃ©s

## ğŸ¯ Convenciones de Nomenclatura

### Archivos y Carpetas
- **snake_case**: Para nombres de archivos y carpetas
- **PascalCase**: Para nombres de clases
- **camelCase**: Para variables y mÃ©todos

### Providers
- Sufijo `Provider`: `FeatureProvider`
- Sufijo `State`: `FeatureState`
- Usar `StateNotifier` con Riverpod

### Estados (Freezed)
```dart
@freezed
class FeatureState with _$FeatureState {
  const factory FeatureState.empty() = _Empty;
  const factory FeatureState.loading() = _Loading;
  const factory FeatureState.loaded({
    required Data data,
  }) = _Loaded;
  const factory FeatureState.error({
    required String message,
  }) = _Error;
}
```

### Modelos
- Sufijo `Model`: `UserModel`
- Sufijo `Entity`: `UserEntity`
- Sufijo `DTO`: `UserDTO`

## ğŸ”§ ConfiguraciÃ³n de Dependencias

### Dependencias Principales
- `provider: ^6.0.3` - GestiÃ³n de estado
- `riverpod: ^2.5.0` - GestiÃ³n de estado avanzada
- `freezed_annotation: ^2.4.1` - Modelos inmutables
- `get_it: ^7.2.0` - InyecciÃ³n de dependencias
- `http: ^0.13.5` - Cliente HTTP
- `shared_preferences: ^2.2.2` - Almacenamiento local
- `firebase_core: ^3.15.2` - Firebase

### Dev Dependencies
- `build_runner: ^2.4.8` - GeneraciÃ³n de cÃ³digo
- `freezed: ^2.4.7` - Generador de Freezed

## ğŸš€ Patrones de ImplementaciÃ³n

### Provider Pattern (Riverpod)
```dart
import 'package:flutter_riverpod/flutter_riverpod.dart';
import '../../domain/use_cases/feature_use_case.dart';
import 'feature_state.dart';

class FeatureProvider extends StateNotifier<FeatureState> {
  final FeatureUseCase useCase;
  
  FeatureProvider({
    required this.useCase,
  }) : super(const FeatureState.loading());

  Future<void> loadData() async {
    state = const FeatureState.loading();

    try {
      final data = await useCase.call();

      if(data == null) {
        state = const FeatureState.empty();
        return;
      }

      state = FeatureState.loaded(data: data);
    } catch (e) {
      state = FeatureState.error(message: e.toString());
    }
  }

  void resetState() {
    state = const FeatureState.loading();
  }
}
```

### Controller Pattern
```dart
import 'package:flutter/material.dart';
import 'package:flutter_riverpod/flutter_riverpod.dart';
import 'package:identaplusschool/features/feature_name/feature_name_export.dart';

part '../screens/feature_name_screen.dart';
part '../screens/feature_name_loading_screen.dart';
part '../screens/feature_name_error_screen.dart';

class FeatureNameController extends ConsumerWidget { 
  const FeatureNameController({super.key});

  @override
  Widget build(BuildContext context, WidgetRef ref) {
     final state = ref.watch(featureNameProvider);
    
    return state.when(
      empty: () => Container(),
      loading: () => const FeatureNameLoadingScreen(),
      loaded: (data) => FeatureNameScreen(data: data),
      error: (message) => const FeatureNameErrorScreen(),
    );  
  }
}
```

### Repository Pattern
```dart
abstract class FeatureRepository {
  Future<List<Data>> getData();
}

class FeatureRepositoryImpl implements FeatureRepository {
  final ApiConnect _client;
  
  @override
  Future<List<Data>> getData() async {
    return await _client.getData();
  }
}
```

### Use Case Pattern
```dart
abstract class FeatureUseCase {
  Future<List<Data>> call();
}

class FeatureUseCaseImpl implements FeatureUseCase {
  final FeatureRepository _repository;
  
  @override
  Future<List<Data>> call() async {
    return await _repository.getData();
  }
}
```

## ğŸŒ ConfiguraciÃ³n de APIs

### Endpoints
- **Base URL**: `https://seaacademic.net/`
- **Path General**: `/services/movilservices.php`
- **AutenticaciÃ³n**: Token en headers

### Estructura de Request
```json
{
  "OPC": "operation_code",
  "USR": "user_id",
  // ... otros parÃ¡metros
}
```

## ğŸ“± NavegaciÃ³n

### Rutas
- Definidas en `lib/core/navigation/constants/route_paths.dart`
- Configuradas en `lib/core/navigation/router.dart`
- Uso de `NavigationCustom` para transiciones

### Ejemplo de NavegaciÃ³n
```dart
Navigator.pushNamed(
  context, 
  pageFeatureDetail,
  arguments: [data],
);
```

## ğŸ¨ UI/UX Guidelines

### Colores
- Definidos en `lib/resources/colors_app.dart`
- Uso de `ColorsApp` para consistencia

### Dimensiones
- Definidas en `lib/resources/dimens_app.dart`
- Uso de `DimensApp` para responsive design

### Strings
- InternacionalizaciÃ³n en `lib/l10n/`
- Uso de `context.strings()` para traducciones

## ğŸ”’ Seguridad

### Almacenamiento
- `flutter_secure_storage` para datos sensibles
- `shared_preferences` para datos no sensibles
- EncriptaciÃ³n de datos crÃ­ticos

### APIs
- ValidaciÃ³n de tokens
- Manejo de errores de autenticaciÃ³n
- Timeouts configurados

## ğŸ“Š Testing

### Estructura de Tests
```
test/
â”œâ”€â”€ unit/
â”œâ”€â”€ widget/
â””â”€â”€ integration/
```

### Convenciones
- Sufijo `_test.dart` para archivos de test
- Uso de `group()` para organizar tests
- Mocks para dependencias externas

## ğŸš€ Deployment

### Build
- `flutter build apk --debug` - APK de desarrollo
- `flutter build apk --release` - APK de producciÃ³n
- `flutter build ios --release` - iOS de producciÃ³n

### ConfiguraciÃ³n
- Firebase configurado
- Splash screen nativo
- Iconos de la aplicaciÃ³n

## ğŸ“ Notas Importantes

1. **Siempre usar Provider para gestiÃ³n de estado**
2. **Seguir Clean Architecture en features**
3. **Usar Freezed para modelos inmutables**
4. **Implementar manejo de errores robusto**
5. **Mantener separaciÃ³n de responsabilidades**
6. **Usar internacionalizaciÃ³n para textos**
7. **Seguir convenciones de nomenclatura**
8. **Implementar loading states**
9. **Manejar estados vacÃ­os y de error**
10. **Usar dependency injection para testing**

## ğŸš€ Reglas de Desarrollo y Rendimiento

### Widgets con `const`
**SIEMPRE** usar `const` cuando sea posible para widgets que no cambian:

```dart
// âœ… CORRECTO
const ExampleWidget({
  super.key,
  required this.title,
});

// âŒ INCORRECTO
ExampleWidget({
  super.key,
  required this.title,
});
```

**Condiciones para usar `const`:**
- Todos los parÃ¡metros son `final` o `const`
- No hay lÃ³gica dinÃ¡mica en el constructor
- El widget no cambia su estado interno

### Ejemplos de uso correcto:
```dart
// Widget simple - SIEMPRE const
const SizedBox(height: 16),

// Widget con parÃ¡metros finales - SIEMPRE const
const Text(
  'Hola Mundo',
  style: TextStyle(fontSize: 16),
),

// Widget personalizado - const si cumple condiciones
const CustomWidget(
  title: 'TÃ­tulo',
  color: Colors.blue,
),
```

### Usar `debugPrint` en lugar de `print`
**SIEMPRE** usar `debugPrint` para logs de desarrollo:

```dart
// âœ… CORRECTO
debugPrint('Usuario logueado: ${user.name}');

// âŒ INCORRECTO
print('Usuario logueado: ${user.name}');
```

**Ventajas de `debugPrint`:**
- Solo se ejecuta en modo debug
- No aparece en builds de producciÃ³n
- Mejor rendimiento en producciÃ³n
- MÃ¡s profesional

### Siempre incluir `super.key`
**SIEMPRE** incluir `super.key` en constructores de widgets:

```dart
// âœ… CORRECTO
class ExampleWidget extends StatelessWidget {
  const ExampleWidget({
    super.key,
    required this.title,
  });
  
  final String title;
  // ... resto del cÃ³digo
}

// âŒ INCORRECTO
class ExampleWidget extends StatelessWidget {
  const ExampleWidget({
    required this.title,
  });
  
  final String title;
  // ... resto del cÃ³digo
}
```

### Template de Widget StatelessWidget
```dart
class StudentCard extends StatelessWidget {
  const StudentCard({
    super.key,
    required this.studentName,
    required this.onTap,
  });

  final String studentName;
  final VoidCallback onTap;

  @override
  Widget build(BuildContext context) {
    return GestureDetector(
      onTap: onTap,
      child: Card(
        child: Text(studentName),
      ),
    );
  }
}
```

### Template de Widget StatefulWidget
```dart
class StudentList extends StatefulWidget {
  const StudentList({
    super.key,
    required this.students,
  });

  final List<Student> students;

  @override
  State<StudentList> createState() => _StudentListState();
}

class _StudentListState extends State<StudentList> {
  @override
  Widget build(BuildContext context) {
    return ListView.builder(
      itemCount: widget.students.length,
      itemBuilder: (context, index) {
        final student = widget.students[index];
        debugPrint('Renderizando estudiante: ${student.name}');
        
        return StudentCard(
          key: ValueKey(student.id),
          studentName: student.name,
          onTap: () => debugPrint('Estudiante seleccionado: ${student.name}'),
        );
      },
    );
  }
}
```

### Checklist de ImplementaciÃ³n
Antes de crear un widget, verificar:

- [ ] Â¿Puede usar `const`? (parÃ¡metros finales, sin lÃ³gica dinÃ¡mica)
- [ ] Â¿Incluye `super.key` en el constructor?
- [ ] Â¿Usa `debugPrint` en lugar de `print`?
- [ ] Â¿Todos los parÃ¡metros son `final`?
- [ ] Â¿El widget es inmutable?

### Beneficios de las Reglas
1. **Mejor Rendimiento**: Widgets `const` se crean una sola vez
2. **CÃ³digo Limpio**: Estructura consistente y profesional
3. **Debugging Seguro**: `debugPrint` solo en desarrollo
4. **Mantenibilidad**: CÃ³digo mÃ¡s fÃ¡cil de mantener y debuggear
5. **Flutter Best Practices**: Sigue las recomendaciones oficiales

## ğŸ”„ Flujo de Desarrollo

1. **Crear feature** siguiendo la estructura establecida
2. **Implementar modelos** con Freezed
3. **Crear datasource** para acceso a datos
4. **Implementar repository** con patrÃ³n Repository
5. **Crear use cases** para lÃ³gica de negocio
6. **Implementar provider** con estado inmutable
7. **Crear pÃ¡ginas** con manejo de estados
8. **Agregar widgets** reutilizables
9. **Configurar navegaciÃ³n** en router
10. **Implementar tests** unitarios y de widget

## ğŸ”§ Dependency Injection (Riverpod)

### ConfiguraciÃ³n de Providers
```dart
import 'package:flutter_riverpod/flutter_riverpod.dart';
import 'package:identaplusschool/core/di/core_di.dart';
import 'package:identaplusschool/features/feature_name/feature_name_export.dart';

// Repository provider
final featureNameRepositoryProvider = Provider<FeatureRepository>((ref) {
  final apiConnect = ref.read(apiConnectProvider);
  return FeatureRepository(client: apiConnect);
});

// Use case provider
final featureNameUseCaseProvider = Provider<FeatureUseCase>((ref) {
  final repository = ref.read(featureNameRepositoryProvider);
  return FeatureUseCase(repository: repository);
});

// Provider (StateNotifier) provider
final featureNameProvider = StateNotifierProvider.autoDispose<FeatureProvider, FeatureState>((ref) {  
  return FeatureProvider(
    useCase: ref.read(featureNameUseCaseProvider),
  );
});
```

## ğŸ“ Archivo de ExportaciÃ³n

### Estructura del archivo export
```dart
// Domain exports
export 'domain/entities/feature_entity.dart';
export 'domain/use_cases/feature_use_case.dart';

// Data exports
export 'data/repositories/feature_repository.dart';

// Presentation exports
export 'presentation/provider/feature_state.dart';
export 'presentation/provider/feature_provider.dart';
export 'presentation/controller/feature_controller.dart';

// Dependency Injection
export 'di/feature_di.dart';
```
