# Rule: Start working on latest Jira ticket

when user types "work on first ticket" or presses "‚åò + ‚áß + J"
then
read file "/Users/kike/mcp/jira_watcher_py/cursor_events.json"
extract the first element of the JSON array
and run:
"""
üé´ Ticket detectado desde Jira Watcher:

    - Clave: {{key}}
    - T√≠tulo: {{summary}}
    - Estado: {{status}}
    - Prioridad: {{priority}}
    - Asignado a: {{assignee}}

    üîß Instrucciones de flujo:

    1Ô∏è‚É£ Obtener contexto completo del ticket:
        - Usa la tool: mcp_Atlassian-MCP-Server_getJiraIssue
        - Par√°metros:
          * cloudId: "https://softwarecosta.atlassian.net"
          * issueIdOrKey: "{{key}}"
        - Analiza la descripci√≥n, comentarios existentes y subtareas
        - Nota: Estamos trabajando con el board 73

    2Ô∏è‚É£ Trabaja sobre la rama actual (no crees nuevas ramas).

    3Ô∏è‚É£ Analiza el contenido del card:

        - Si el status es COMMENTS:
          * IMPORTANTE: El ticket est√° esperando atenci√≥n de comentarios
          * Paso 1 - Obtener comentarios del ticket:
            - Ya obtuviste el issue con getJiraIssue en el paso 1Ô∏è‚É£
            - Los comentarios est√°n en: issue.fields.comment.comments[]
            - Cada comentario tiene: author.displayName, body, created
          * Paso 2 - Analizar la conversaci√≥n en los comentarios:
            a) Ordenar comentarios por fecha (m√°s reciente √∫ltimo)
            b) Identificar el √∫ltimo comentario del usuario humano (no de Cursor/IA)
               - Cursor/IA: Contiene ‚úÖ, üîß, formato markdown estructurado, hash de commit
               - Usuario: Comentarios normales, solicitudes, preguntas
            c) Verificar si hay una respuesta de Cursor despu√©s de ese comentario
          * Paso 3 - Si NO hay respuesta de Cursor despu√©s del √∫ltimo comentario de usuario:
               ‚Üí Significa que hay comentarios sin atender
               ‚Üí Leer detenidamente el comentario del usuario
               ‚Üí Entender qu√© aclaraciones o cambios solicita
               ‚Üí Implementar los cambios solicitados
               ‚Üí Responder al comentario con:
                 - Tool: mcp_Atlassian-MCP-Server_addCommentToJiraIssue
                 - Par√°metros:
                   * cloudId: "https://softwarecosta.atlassian.net"
                   * issueIdOrKey: "{{key}}"
                   * commentBody: "‚úÖ Comentarios atendidos:\n\n[Detalla qu√© cambios hiciste basado en los comentarios]\n\nüîß Cambios realizados:\n- [lista espec√≠fica]\n\nüì¶ Commit: [hash]"
               ‚Üí Obtener transiciones disponibles
               ‚Üí Mover el ticket a IN PROGRESS o TESTING seg√∫n corresponda
          * Paso 4 - Si S√ç hay respuesta de Cursor pero el ticket sigue en COMMENTS:
               ‚Üí El usuario movi√≥ el ticket de vuelta a COMMENTS despu√©s de tu respuesta
               ‚Üí Significa que tu respuesta no fue suficiente o hay nuevas solicitudes
               ‚Üí Revisar el comentario m√°s reciente del usuario (despu√©s de tu √∫ltima respuesta)
               ‚Üí Implementar los cambios adicionales solicitados
          * Paso 5 - Despu√©s de implementar los cambios:
               ‚Üí Crear commit con los cambios
               ‚Üí Agregar comentario detallado en Jira
               ‚Üí Mover a TESTING (no a IN PROGRESS, ya que es una correcci√≥n)

        - Si hay subtareas:
          * Entender el contexto de cada subtarea
          * Para cada subtarea:
            a) Usar mcp_Atlassian-MCP-Server_getJiraIssue para obtener detalles
            b) Crear TODOs para completar la subtarea
            c) IMPORTANTE: Primero obtener transiciones disponibles con:
               - Tool: mcp_Atlassian-MCP-Server_getTransitionsForJiraIssue
               - Par√°metros:
                 * cloudId: "https://softwarecosta.atlassian.net"
                 * issueIdOrKey: "{{subtask_key}}"
            d) Mover la subtarea a IN PROGRESS con:
               - Tool: mcp_Atlassian-MCP-Server_transitionJiraIssue
               - Par√°metros:
                 * cloudId: "https://softwarecosta.atlassian.net"
                 * issueIdOrKey: "{{subtask_key}}"
                 * transition: {"id": "{{transition_id_for_in_progress}}"}
            e) Implementar los cambios necesarios
            f) Al finalizar, crear un commit
            g) Mover la subtarea a DONE con:
               - Tool: mcp_Atlassian-MCP-Server_transitionJiraIssue
               - Par√°metros:
                 * cloudId: "https://softwarecosta.atlassian.net"
                 * issueIdOrKey: "{{subtask_key}}"
                 * transition: {"id": "{{transition_id_for_done}}"}

        - Si NO entiendes el contexto:
            a) Escribe un comentario en Jira pidiendo aclaraci√≥n:
               - Tool: mcp_Atlassian-MCP-Server_addCommentToJiraIssue
               - Par√°metros:
                 * cloudId: "https://softwarecosta.atlassian.net"
                 * issueIdOrKey: "{{key}}"
                 * commentBody: "Necesito m√°s contexto sobre [especifica qu√© necesitas]..."
            b) Obtener transiciones disponibles primero
            c) Mueve el card a status COMMENTS:
               - Tool: mcp_Atlassian-MCP-Server_transitionJiraIssue
               - Par√°metros:
                 * cloudId: "https://softwarecosta.atlassian.net"
                 * issueIdOrKey: "{{key}}"
                 * transition: {"id": "{{transition_id_for_comments}}"}

        - Si S√ç entiendes lo que debes hacer:
            a) Primero obtener transiciones disponibles con getTransitionsForJiraIssue
            b) Mueve el card a IN PROGRESS:
               - Tool: mcp_Atlassian-MCP-Server_transitionJiraIssue
               - Par√°metros:
                 * cloudId: "https://softwarecosta.atlassian.net"
                 * issueIdOrKey: "{{key}}"
                 * transition: {"id": "{{transition_id_for_in_progress}}"}
            c) Procede con la implementaci√≥n

    4Ô∏è‚É£ Al finalizar la implementaci√≥n:
        a) Lanza la app en el emulador disponible
        b) Si hay errores, corr√≠gelos y vuelve a lanzar
        c) Cuando todo funcione correctamente:

           * Crea un commit con el formato:
             ‚ú® {{key}}: descripci√≥n breve del cambio

           * Sube los cambios en la rama actual (git push)

           * Escribe un comentario detallado en Jira:
             - Tool: mcp_Atlassian-MCP-Server_addCommentToJiraIssue
             - Par√°metros:
               * cloudId: "https://softwarecosta.atlassian.net"
               * issueIdOrKey: "{{key}}"
               * commentBody: "‚úÖ Cambios implementados:\n\n[Detalla los cambios realizados]\n\nüîß Archivos modificados:\n- [lista de archivos]\n\n‚ú® Commit: [hash del commit]"

           * Obtener transiciones disponibles con getTransitionsForJiraIssue

           * Mueve el card a TESTING:
             - Tool: mcp_Atlassian-MCP-Server_transitionJiraIssue
             - Par√°metros:
               * cloudId: "https://softwarecosta.atlassian.net"
               * issueIdOrKey: "{{key}}"
               * transition: {"id": "{{transition_id_for_testing}}"}

    üìù IMPORTANTE:
    - Siempre obtener las transiciones disponibles ANTES de intentar cambiar el estado
    - Usar el transition ID correcto seg√∫n lo que devuelva getTransitionsForJiraIssue
    - CloudId configurado: https://softwarecosta.atlassian.net
    - Board ID: 73
    - Puedes verificar la conexi√≥n con mcp_Atlassian-MCP-Server_getAccessibleAtlassianResources si es necesario

    üí¨ MANEJO DE COMENTARIOS:
    - Los comentarios de usuarios aparecen en el campo "comment" del issue
    - Cada comentario tiene un "author" con informaci√≥n del usuario
    - Los comentarios de Cursor/IA t√≠picamente contienen:
      * Emojis como ‚úÖ, üîß, üì¶, ‚ú®
      * Formato markdown con secciones
      * Menciones a commits (hash)
      * Mensajes estructurados sobre implementaci√≥n
    - Si el √∫ltimo comentario es de un usuario y NO tiene respuesta de Cursor ‚Üí Hay comentarios sin atender
    - Si hay comentarios sin atender ‚Üí Priorizar atenderlos antes de continuar con otras tareas
    """
